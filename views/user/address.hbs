<main class="page-wrapper">
    <!-- Modal-AddNew-Address-->
    <form  action="/add/address" class="needs-validation modal fade" method="post" id="add-address" tabindex="-1" novalidate>
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Add a new address</h5>
              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row gx-4 gy-3">
                <div class="col-sm-6">
                    <input type="hidden" class="form-control" name="email" value="{{headerData.user.email}}">
                  <label class="form-label" for="address-fn">First name</label>
                  <input class="form-control" name="firstName" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" type="text" id="address-fn" required="">
                  <div class="invalid-feedback">Please fill in you first name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-ln">Last name</label>
                  <input class="form-control" name="lastName" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" type="text" id="address-ln" required="">
                  <div class="invalid-feedback">Please fill in you last name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-">address1</label>
                  <input class="form-control" name="address1" pattern="(^[A-Za-z]+$)$" title="Please enter a valid address"type="text" id="address-company">
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-country">Country</label>
                  <select class="form-select" id="address-country" name="country" required>
                    <option selected = "">India</option>
                    
                    {{!-- <option value="Belgium">Belgium</option>
                    <option value="France">France</option>
                    <option value="Germany">Germany</option>
                    <option value="Spain">Spain</option>
                    <option value="UK">United Kingdom</option>
                    <option value="USA">USA</option> --}}
                  </select>
                  <div class="invalid-feedback">Please select your country!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-city">City</label>
                  <input class="form-control" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" name="city" type="text" id="address-city" required>
                  <div class="invalid-feedback">Please fill in your city!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-line1">State</label>
                  <input class="form-control" type="text" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" name="state" id="address-line1" required>
                  <div class="invalid-feedback">Please fill in your address!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">ZIP code</label>
                  <input class="form-control" type="text"title="please enter a zip code" pattern="^.{6,}$" name="zipCode" id="address-zip" required>
                  <div class="invalid-feedback">Please add your ZIP code!</div>
                </div>
                <div class="col-sm-6">
                    <label class="form-label" for="address-line2">Address Name</label>
                  <input class="form-control" type="text" name="addrname" pattern="(^[A-Za-z]+$)$"  title="Please enter a valid name" id="address-line2">
                  
                </div>
                <div class="col-12">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="address-primary">
                    <label class="form-check-label" for="address-primary">Make this address primary</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
              <button class="btn btn-primary btn-shadow" type="submit">Add address</button>
            </div>
          </div>
        </div>
      </form>

      <!-- Edit Address Modal-->
    
     <form   class="needs-validation modal fade"  id="editAddress" tabindex="-1" novalidate>
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Edit address</h5>
              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row gx-4 gy-3">
                <div class="col-sm-6">
                    <input type="hidden" class="form-control" name="emailId" id="emailId" value="{{headerData.user.email}}">
                  <label class="form-label" for="address-fn">First name</label>
                  <input class="form-control" name="firstName" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" type="text" id="firstName" required="">
                  <div class="invalid-feedback">Please fill in you first name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-ln">Last name</label>
                  <input class="form-control" name="lastName" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" type="text" id="lastName" required="">
                  <div class="invalid-feedback">Please fill in you last name!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-">address1</label>
                  <input class="form-control" name="address1" pattern="(^[A-Za-z]+$)$" title="Please enter a valid address"type="text" id="address1">
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-country">Country</label>
                  <select class="form-select" id="address-country" name="country" required>
                    <option selected = "">India</option>
                    
                    {{!-- <option value="Belgium">Belgium</option>
                    <option value="France">France</option>
                    <option value="Germany">Germany</option>
                    <option value="Spain">Spain</option>
                    <option value="UK">United Kingdom</option>
                    <option value="USA">USA</option> --}}
                  </select>
                  <div class="invalid-feedback">Please select your country!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-city">City</label>
                  <input class="form-control" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" name="city" type="text" id="city" required>
                  <div class="invalid-feedback">Please fill in your city!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-line1">State</label>
                  <input class="form-control" type="text" pattern="(^[A-Za-z]+$)$" title="Please enter a valid name" name="state" id="state" required>
                  <div class="invalid-feedback">Please fill in your address!</div>
                </div>
                <div class="col-sm-6">
                  <label class="form-label" for="address-zip">ZIP code</label>
                  <input class="form-control" type="text"title="please enter a zip code" pattern="^.{6,}$" name="zipCode" id="zipCode" required>
                  <div class="invalid-feedback">Please add your ZIP code!</div>
                </div>
                <div class="col-sm-6">
                    <label class="form-label" for="address-line2">Address Name</label>
                  <input class="form-control" type="text" name="addrname" pattern="(^[A-Za-z]+$)$"  title="Please enter a valid name" id="addrname">
                  
                </div>
                <div class="col-12">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="address-primary">
                    <label class="form-check-label" for="address-primary">Make this address primary</label>
                  </div>
                </div>
              </div>
            </div>
             <input type="hidden" id="id" >
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
              <button class="btn btn-primary btn-shadow" type="submit">Save address</button>
            </div>
          </div>
        </div>
      </form> 
    
  <!-- Page Title-->
  <div class="page-title-overlap bg-dark pt-4">
    <div class="container d-lg-flex justify-content-between py-2 py-lg-3">
      <div class="order-lg-2 mb-3 mb-lg-0 pt-lg-2">
        <nav aria-label="breadcrumb">
          <ol
            class="breadcrumb breadcrumb-light flex-lg-nowrap justify-content-center justify-content-lg-start"
          >
            <li class="breadcrumb-item"><a
                class="text-nowrap"
                href="/"
              ><i class="ci-home"></i>Home</a></li>
            <li class="breadcrumb-item text-nowrap"><a href="/profile-settings">Account</a>
            </li>
            <li
              class="breadcrumb-item text-nowrap active"
              aria-current="page"
            >Addresses</li>
          </ol>
        </nav>
      </div>
      <div class="order-lg-1 pe-lg-4 text-center text-lg-start">
        <h1 class="h3 text-light mb-0">My addresses</h1>
      </div>
    </div>
  </div>
   <div class="container pb-5 mb-2 mb-md-4">
        <div class="row">
          <!-- Sidebar-->
           {{> user-profile}}
          <!-- Content  -->
          <section class="col-lg-8">
            <!-- Toolbar-->
            <div class="d-none d-lg-flex justify-content-between align-items-center pt-lg-3 pb-4 pb-lg-5 mb-lg-3">
              <h6 class="fs-base text-light mb-0">List of your registered addresses:</h6><a class="btn btn-primary btn-sm" href="/signout"><i class="ci-sign-out me-2"></i>Sign out</a>
            </div>
            <!-- Addresses list-->
            <div class="table-responsive fs-md">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th>Address</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                    {{#each userAddress}}
                  <tr id="address_{{id}}">
                    <td class="py-3 align-middle">{{firstName}} {{lastName}},{{address1}},{{city}}, {{state}}, {{country}},{{zipCode}}<span class="align-middle badge bg-info ms-2">{{addrname}}</span></td>
                    
                    <td class="py-3 align-middle"><a class="nav-link-style me-2" href="#" data-bs-toggle="tooltip" onclick="getAddressDetails('{{id}}')" title="Edit"><i class="ci-edit"></i></a>
                    
                    
                    <a class="nav-link-style text-danger" href="#"  data-bs-toggle="modal" onclick="deleteAddress('{{id}}')" data-bs-target="#deleteAddressModal" title="Remove">
                        <i class="ci-trash"></i>
                    </a>
                       
                        </td>
                  </tr>
                  
                  {{/each}}
                </tbody>
              </table>
            </div>
            <div class="text-sm-end pt-4"><a class="btn btn-primary" href="#add-address" data-bs-toggle="modal">Add new address</a></div>
          </section>
        </div>
      </div>
      <!-- Modal -->
       <div class="modal fade" id="deleteAddressModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <!-- modal content -->
        <div class="modal-content">
            <!-- modal header -->
            <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel">Delete address</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- modal body -->
            <div class="modal-body">
            <h6>Are you sure you want to delete this address?</h6>
            <input type="hidden" id="addressId">
            </div>
            <!-- modal footer -->
            <div class="modal-footer">
            <!-- btn -->
            <button type="button" class="btn btn-outline-gray-400" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
        </div>
    </div>
</main>
<script>
   function deleteAddress(id){
    
        document.getElementById('addressId').value = id
    }

    async function confirmDelete(){
      
        let id = document.getElementById('addressId').value
        let response = await fetch('/address/delete/'+id, {
            method: 'put',
        });
        let result = await response.json();
        if(result == 'success'){
            $("#address_"+id).remove();
        }
        $('#deleteAddressModal').modal('hide')
        $('.modal-backdrop').remove();
    }
   async function getAddressDetails(id){
          
         let details =  await fetch('/edit/address/'+id,{
            method:'get'
        });
        let userDetails = await details.json()
        if(userDetails){
             
            let address = userDetails.address[0]
            document.getElementById('firstName').value = address.firstName
            console.log(address.firstName)

            document.getElementById('lastName').value = address.lastName
            
            console.log(address.lastName)
            document.getElementById('address1').value = address.address1
            console.log(address.address1)
            document.getElementById('city').value = address.city 
            console.log(address.city) 
            document.getElementById('state').value = address.state
            console.log(address.state)
            document.getElementById('zipCode').value = address.zipCode
            console.log(address.zipCode)
            document.getElementById('addrname').value = address.addrname
            console.log(address.addrname) 
             document.getElementById('id').value = id
            
            
        }
        $('#editAddress').modal('show')
    }

 const form  = document.getElementById('editAddress');
    form.addEventListener('submit', async(event) => {
      
        event.preventDefault();
        const formValues={
            firstName:document.getElementById('firstName').value,
            lastName:document.getElementById('lastName').value,
            address1:document.getElementById('address1').value,
            
            city:document.getElementById('city').value,
            state:document.getElementById('state').value,
            zipCode:document.getElementById('zipCode').value,
            addrname:document.getElementById('addrname').value,
            email:document.getElementById('emailId').value,
        }
        
        const id = document.getElementById('id').value
        const updateAddr = await fetch('/update/address/'+id,{
            method : 'post',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formValues)
        })
        const response = await updateAddr.json();
        if(response=="success"){
          $('#editAddress').modal('hide')
            Swal.fire({
                title: 'Success',
                text: "Address updated successfully !",
                icon: 'success',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'OK',
                timer: 3000
            }).then(()=>{
              document.location.href = '/profile-address'
            })
          }else{
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'Something went wrong!',
            })
          }
        
    });
         



</script>
